<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Collecting Data</title>
    <link rel="stylesheet" />
  </head>

  <body class="container" style="margin-top: 50px; width: 50%; height: auto">
    <h2 class="text-primary" style="margin-left: 15px; margin-bottom: 10px">
      Hey There, Here we are going to upload
    </h2>

    <form class="container" id="contactForm">
      <div class="card">
        <div class="card-body">
          <div
            class="form-group"
            style="margin-left: 15px; margin-top: 10px; display: none"
          >
            <label for="exampleFormControlSelect1">Select Type</label>
            <select class="form-control" id="types">
              <option>1</option>
            </select>
          </div>

          <br />Document Upload:<br />
          <!-- click here to choose file -->
          <input type="file" name="files[]" id="files" />
          <!-- click here to upload file -->
          <input type="hidden" name="url" id="url" />
          <button type="button" onclick="uploadImage()">Upload Image</button>
          <br /><br />
        </div>
      </div>

      <button
        type="submit"
        class="btn btn-primary"
        style="margin-left: 15px; margin-top: 10px; display: none"
      >
        Submit
      </button>
    </form>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-storage.js"></script>

    <script>
      // Firebase configuration (replace with your own Firebase config)
      const firebaseConfig = {
        apiKey: "AIzaSyAtj1SB8ZlBhwChqRr7V_9hJQSqCW5zdjo",
        authDomain: "dht-trace.firebaseapp.com",
        projectId: "dht-trace",
        storageBucket: "dht-trace.appspot.com",
        messagingSenderId: "436573278890",
        appId: "1:436573278890:web:1c73f0e0c5f7f8ee60b6d3",
        measurementId: "G-3G5HGVCL6W",
      };
      firebase.initializeApp(firebaseConfig);

      var messagesRef = firebase.database().ref("Checking");

      // Function to handle file upload
      function uploadImage() {
        var type = getInputVal("types");
        var storage = firebase.storage();
        var file = document.getElementById("files").files[0];

        if (!file) {
          alert("Please select a file first!");
          return;
        }

        var storageref = storage.ref();
        var thisref = storageref.child(type).child(file.name).put(file);

        thisref.on(
          "state_changed",
          function (snapshot) {
            // You can track upload progress here
          },
          function (error) {
            // Handle unsuccessful uploads
            console.error("Upload error:", error);
          },
          function () {
            // Handle successful uploads
            thisref.snapshot.ref.getDownloadURL().then(function (downloadURL) {
              document.getElementById("url").value = downloadURL;
              alert("Uploaded successfully!");
              saveMessage(downloadURL);
            });
          }
        );
      }

      // Function to get input values
      function getInputVal(id) {
        return document.getElementById(id).value;
      }

      // Save message to firebase database
      function saveMessage(url) {
        var newMessageRef = messagesRef.push();
        newMessageRef.set({
          imageurl: url,
        });
      }
    </script>
  </body>
</html>
